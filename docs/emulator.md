# Azure SignalR Local Emulator

When developing serverless applications, we provide an Azure SignalR Local Emulator to make the local development and integration easier. Please note that the emulator works only for serverless scenarios, for *Default* mode that the Azure SignalR Service acts as a proxy, you can directly use self-host SignalR to do local development.

Features available
------------------
1. Auth
2. Latest Rest API support
3. Upstream

Walkthrough
----------------
Take this serverless sample for example https://github.com/Azure/azure-functions-signalrservice-extension/tree/master/samples/bidirectional-chat 
1. Clone the sample repo to local
```
git clone https://github.com/Azure/azure-functions-signalrservice-extension.git
cd azure-functions-signalrservice-extension/samples/bidirectional-chat
```

2. Install the emulator
```
dotnet tool install  -g Microsoft.Azure.SignalR.Emulator --version 1.0.0-preview1-10719 --add-source https://www.myget.org/F/azure-signalr-dev/api/v3/index.json
```
Or update the emulator to the latest preview version if it is already installed:
```
dotnet tool update -g Microsoft.Azure.SignalR.Emulator --version 1.0.0-preview1-10719 --add-source https://www.myget.org/F/azure-signalr-dev/api/v3/index.json
```

3. Run the emulator `asrs-emulator` to list all the available commands:
![image](https://user-images.githubusercontent.com/668244/93064883-a7e69080-f6aa-11ea-925a-89149e32c233.png)

4. Init the default upstream settings using:
```
asrs-emulator upstream init
```

It inits a default `settings.json` into the current folder, with a default upstream `UrlTemplate` as `http://localhost:7071/runtime/webhooks/signalr`, which is the URL for SignalR's **local** function trigger:
```json
{
  "UpstreamSettings": {
    "Templates": [
      {
        "UrlTemplate": "http://localhost:7071/runtime/webhooks/signalr",
        "EventPattern": "*",
        "HubPattern": "*",
        "CategoryPattern": "*"
      }
    ]
  }
}
```

You can edit the file to make the pattern more restricted, for example, change `HubPattern` from `*` to `chat`. When the file is modified, its change will be hot loaded into the emulator.

5. Start the emulator
```
asrs-emulator start
```

After the emulator is successfully started, it generates the ConnectionString to be used later, for example, the ConnectionString is `Endpoint=http://localhost;Port=8888;AccessKey=ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789ABCDEFGH;Version=1.0;` as the below screenshot shows.

![image](https://user-images.githubusercontent.com/668244/93065543-6d312800-f6ab-11ea-96de-02ae660cf5d1.png)

The emulator also provides advanced options when start, for example, you can use `asrs-emulator start -p 8999` to customize the port the emulator used. Type `asrs-emulator start --help` to check the options available.

6. Go into subfolder `csharp` and rename `local.settings.sample.json` to `local.settings.json`, use the ConnectionString generated by the emulator to fill into the value of the **AzureSignalRConnectionString** in your **local.settings.json**. Fill into `AzureWebJobsStorage` your storage connection string, for example, `UseDevelopmentStorage=true` when using storage emulator. Save the file and run the function in the `csharp` subfolder with `func start`.

![image](https://user-images.githubusercontent.com/668244/93066236-563f0580-f6ac-11ea-8d81-b63adc83e042.png)

7. In the browser, navigate to `http://localhost:7071/api/index` to play with the demo.

![image](https://user-images.githubusercontent.com/668244/93066361-78d11e80-f6ac-11ea-8b2e-bff28196850c.png)
